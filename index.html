<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sticker Stock Management</title>

    <!-- Excel Export Library -->
   <script>
const API_URL = "https://script.google.com/macros/s/AKfycbzvq5i0EQG65DgBtgUiLUiYS0khcNPLiuFBhoFFi3RbOvrrLn85iRMQPzCAaAu0gh94FA/exec";
let transactions = [];

// Load data from Google Sheet
async function loadTransactions() {
    const res = await fetch(API_URL);
    transactions = await res.json();
}

// Save transaction to Google Sheet
async function addTransaction(t) {
    await fetch(API_URL, {
        method: "POST",
        body: JSON.stringify(t)
    });
    await loadTransactions();
    render();
}

// On page load
window.onload = async () => {
    await loadTransactions();
    render();

    const today = new Date().toISOString().split('T')[0];
    document.getElementById("r-date").value = today;
    document.getElementById("c-date").value = today;
};

// Receive form
document.getElementById("receive-form").addEventListener("submit", async (e) => {
    e.preventDefault();

    await addTransaction({
        id: Date.now(),
        date: document.getElementById("r-date").value,
        type: "Receive",
        ir: document.getElementById("r-ir").value,
        qty: Number(document.getElementById("r-qty").value)
    });

    e.target.reset();
});

// Consume form
document.getElementById("consume-form").addEventListener("submit", async (e) => {
    e.preventDefault();

    await addTransaction({
        id: Date.now(),
        date: document.getElementById("c-date").value,
        type: "Consume",
        ir: "-",
        qty: Number(document.getElementById("c-qty").value)
    });

    e.target.reset();
});

// Render table & summary
function render() {
    const tbody = document.getElementById("transaction-body");
    tbody.innerHTML = "";

    let totalR = 0;
    let totalC = 0;

    transactions.forEach(t => {
        if (t.type === "Receive") totalR += t.qty;
        else totalC += t.qty;

        tbody.innerHTML += `
            <tr>
                <td>${t.date}</td>
                <td>${t.type}</td>
                <td>${t.ir}</td>
                <td>${t.qty}</td>
                <td>-</td>
            </tr>
        `;
    });

    document.getElementById("total-received").innerText = totalR;
    document.getElementById("total-consumed").innerText = totalC;
    document.getElementById("current-stock").innerText = totalR - totalC;
}

// Excel export
function exportToExcel() {
    const data = transactions.map(t => ({
        Date: t.date,
        Type: t.type,
        "IR Number": t.ir,
        Quantity: t.qty
    }));

    const ws = XLSX.utils.json_to_sheet(data);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "Stock Data");
    XLSX.writeFile(wb, "Sticker_Stock_Report.xlsx");
}
</script>


    <style>
        :root {
            --primary: #2563eb;
            --danger: #dc2626;
            --success: #16a34a;
            --bg: #f8fafc;
            --card: #ffffff;
            --text: #1e293b;
        }

        * { box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background-color: var(--bg); color: var(--text); margin: 0; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; }
        h2 { text-align: center; color: #334155; }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: var(--card);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            text-align: center;
        }

        .card h3 { margin: 0; font-size: 0.9rem; text-transform: uppercase; opacity: 0.8; }
        .card .value { font-size: 2rem; font-weight: bold; margin-top: 10px; }

        .received { border-top: 5px solid var(--primary); color: var(--primary); }
        .consumed { border-top: 5px solid var(--danger); color: var(--danger); }
        .stock { border-top: 5px solid var(--success); color: var(--success); }

        .forms-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        form {
            background: var(--card);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .input-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: 600; }

        input {
            width: 100%;
            padding: 10px;
            border: 1px solid #cbd5e1;
            border-radius: 6px;
        }

        button {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
        }

        .btn-receive { background: var(--primary); color: white; }
        .btn-consume { background: var(--danger); color: white; }
        .btn-export { background: #64748b; color: white; margin-bottom: 20px; }

        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px; border-bottom: 1px solid #e2e8f0; }
        th { background: #f1f5f9; }
    </style>
</head>

<body>

<div class="container">
    <h2>Sticker Stock Management</h2>

    <div class="summary-grid">
        <div class="card received">
            <h3>Total Received</h3>
            <div id="total-received" class="value">0</div>
        </div>
        <div class="card consumed">
            <h3>Total Consumed</h3>
            <div id="total-consumed" class="value">0</div>
        </div>
        <div class="card stock">
            <h3>Current Stock</h3>
            <div id="current-stock" class="value">0</div>
        </div>
    </div>

    <div class="forms-container">
        <form id="receive-form">
            <h4>Receive Stickers</h4>
            <div class="input-group">
                <label>Date</label>
                <input type="date" id="r-date" required>
            </div>
            <div class="input-group">
                <label>IR Number</label>
                <input type="text" id="r-ir" required>
            </div>
            <div class="input-group">
                <label>Quantity</label>
                <input type="number" id="r-qty" min="1" required>
            </div>
            <button class="btn-receive">Add Stock</button>
        </form>

        <form id="consume-form">
            <h4>Consume Stickers</h4>
            <div class="input-group">
                <label>Date</label>
                <input type="date" id="c-date" required>
            </div>
            <div class="input-group">
                <label>Quantity</label>
                <input type="number" id="c-qty" min="1" required>
            </div>
            <button class="btn-consume">Record Consumption</button>
        </form>
    </div>

    <button class="btn-export" onclick="exportToExcel()">Export to Excel</button>

    <table>
        <thead>
            <tr>
                <th>Date</th>
                <th>Type</th>
                <th>IR Number</th>
                <th>Quantity</th>
            </tr>
        </thead>
        <tbody id="transaction-body"></tbody>
    </table>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbzvq5i0EQG65DgBtgUiLUiYS0khcNPLiuFBhoFFi3RbOvrrLn85iRMQPzCAaAu0gh94FA/exec";
let transactions = [];

async function loadTransactions() {
    const res = await fetch(API_URL);
    transactions = await res.json();
}

async function addTransaction(t) {
    await fetch(API_URL, {
        method: "POST",
        body: JSON.stringify(t)
    });
    await loadTransactions();
    render();
}

window.onload = async () => {
    await loadTransactions();
    render();
    const today = new Date().toISOString().split('T')[0];
    document.getElementById("r-date").value = today;
    document.getElementById("c-date").value = today;
};

document.getElementById("receive-form").addEventListener("submit", async e => {
    e.preventDefault();
    await addTransaction({
        id: Date.now(),
        date: r-date.value,
        type: "Receive",
        ir: r-ir.value,
        qty: Number(r-qty.value)
    });
    e.target.reset();
});

document.getElementById("consume-form").addEventListener("submit", async e => {
    e.preventDefault();
    await addTransaction({
        id: Date.now(),
        date: c-date.value,
        type: "Consume",
        ir: "-",
        qty: Number(c-qty.value)
    });
    e.target.reset();
});

function render() {
    const body = document.getElementById("transaction-body");
    body.innerHTML = "";
    let r = 0, c = 0;

    transactions.forEach(t => {
        t.type === "Receive" ? r += t.qty : c += t.qty;
        body.innerHTML += `
            <tr>
                <td>${t.date}</td>
                <td>${t.type}</td>
                <td>${t.ir}</td>
                <td>${t.qty}</td>
            </tr>`;
    });

    total-received.innerText = r;
    total-consumed.innerText = c;
    current-stock.innerText = r - c;
}

function exportToExcel() {
    const ws = XLSX.utils.json_to_sheet(transactions);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "Stock");
    XLSX.writeFile(wb, "Sticker_Stock.xlsx");
}
</script>

</body>
</html>
 
